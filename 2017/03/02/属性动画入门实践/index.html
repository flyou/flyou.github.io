<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>属性动画入门实践 | </title>
    <meta name="author" content="flyou">
    
    <meta name="description" content="前言说道动画肯定要先介绍一下，逐帧动画(frame-by-frame animation)和补间动画(tweened animation)。逐帧动画和补间动画是Android出生时就具有的动画。所谓的补间动画就是一个视图上在指定的时间和时间长度下显示某张图片，一般用于加载动画或者做一些简单的展示。所">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="属性动画入门实践"/>
    <meta property="og:site_name" content="flyou Dream"/>

    
    <meta property="og:image" content="undefined"/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="flyou Dream" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/atelier-sulphurpool-dark.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="indigo">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">flyou Dream</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            分类
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-reading " href="/reading" >
                            <i class="fa fa-book "></i>
                            
                            读书
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            关于
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            搜索
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav indigo darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="http://tva2.sinaimg.cn/crop.0.3.707.707.180/a2f7c645jw8f6qvlbp1g7j20js0jrgrz.jpg" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">房泽龙</p>
                        <p class="desc">Android/Python/技术宅</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    首页
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    归档
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    分类
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-reading " href="/reading" >
                    <i class="fa fa-book "></i>
                    
                    读书
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    关于
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    搜索
                </a>
            </li>
        
    </ul>

    <ul class="side-nav indigo darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/技术领域/">
                    技术领域 <span class="right">6 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/技术领域/Android/">
                    Android <span class="right">5 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/技术领域/安全/">
                    安全 <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/随笔/">
                    随笔 <span class="right">2 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/随笔/没事闲叨叨/">
                    没事闲叨叨 <span class="right">2 篇</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">搜索</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper indigo">
        <span class="breadcrumb">当前位置（分类目录）</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/技术领域/">技术领域</a><a class="breadcrumb" href="/categories/技术领域/Android/">Android</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>属性动画入门实践</h1>
    


            </div>
            <time class="light-green-link-context" datetime="2017-03-01T17:46:32.000Z"><a href="/2017/03/02/属性动画入门实践/">2017-03-02</a></time>

            
    <div class="tags-row">
        
            <a href="/tags/属性动画/" class="chip light-green lighten-1">属性动画</a>
        
            <a href="/tags/property-animation/" class="chip light-green lighten-1">property animation</a>
        
            <a href="/tags/animation/" class="chip light-green lighten-1">animation</a>
        
    </div>


            <div class="toc light-green-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#前言"><span class="section table-of-contents-text">前言</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#什么是属性动画"><span class="section table-of-contents-text">什么是属性动画</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#ValueAnimator"><span class="section table-of-contents-text">ValueAnimator</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#ObjectAnimator"><span class="section table-of-contents-text">ObjectAnimator</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#基本用法"><span class="section table-of-contents-text">基本用法</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#使用xml文件创建属性动画"><span class="section table-of-contents-text">使用xml文件创建属性动画</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#自定义属性"><span class="section table-of-contents-text">自定义属性</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Interpolator"><span class="section table-of-contents-text">Interpolator</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#PathInterpolator"><span class="section table-of-contents-text">PathInterpolator</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Evaluator"><span class="section table-of-contents-text">Evaluator</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#如何自定义Evaluator"><span class="section table-of-contents-text">如何自定义Evaluator</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#ViewPropertyAnimator"><span class="section table-of-contents-text">ViewPropertyAnimator</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#后记"><span class="section table-of-contents-text">后记</span></a></li></ol>
</div>


            <div class="entry light-green-link-context">
                <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>说道动画肯定要先介绍一下，逐帧动画(frame-by-frame animation)和补间动画(tweened animation)。<br>逐帧动画和补间动画是Android出生时就具有的动画。所谓的补间动画就是一个视图上在指定的时间和时间长度下显示某张图片，一般用于加载动画或者做一些简单的展示。<br><br>所谓的补间动画也很简单，学习过flash的读者肯定会很熟悉此类动画，因为它基本和flash的动画模式是一样的，可以对一个元素或者视图做透明度、缩放、平移、旋转动画，当然你也可以把四类组合起来使用完成比较炫酷的效果<br></p>
<p>不过，你以为我给你具体介绍下上面两种动画的用法？<br><br>你想太多了，我可没说今天要讲那玩意，需要的自行google去</p>
<p><img src="http://ww1.sinaimg.cn/large/0060lm7Tgy1fd72y1al3uj309p06c748.jpg" alt=""></p>
<h3 id="什么是属性动画"><a href="#什么是属性动画" class="headerlink" title="什么是属性动画"></a>什么是属性动画</h3><p>属性动画是google在Android3.0以后加入的新的动画机制，为什么叫属性动画呢？因为它是根据对象的属性来改变属性的值，最终达到属性动画的效果。<br><br>这么说所有的对象都可以使用属性动画？对的，只要该对象具有相应属性并具有相应的的get和set方法就可以根据自己的需求来实现的自己的动画。<br>那么属性动画又有什么<strong>优点</strong>呢？</p>
<ul>
<li>所有对象都支持</li>
<li>view的坐标随着动画一起移动</li>
<li>更多的插值器，并支持自定义</li>
<li>配置方便自定义程度高</li>
</ul>
<p>说了这么多，还是来看看怎么用吧</p>
<h2 id="ValueAnimator"><a href="#ValueAnimator" class="headerlink" title="ValueAnimator"></a>ValueAnimator</h2><p>值动画是属性动画中最基本也是最重要的一个类，因为属性动画是基于属性值改变来完成的，具体为什么这么重要，看下面的图就知道了。</p>
<p><img src="http://ww2.sinaimg.cn/large/0060lm7Tgy1fd73rs72txj30k306o0tl.jpg" alt=""><br>从图中我们可以很清楚的看到，ValueAnimator可以设置插值器（TimeInterpolator）、值评估器（TypeEvaluator）、时间（duration）、以及开始值和结束的值，设置监听等。</p>
<pre><code> ValueAnimator valueAnimator = new ValueAnimator().ofFloat(0, 500);
valueAnimator.setDuration(3000);
valueAnimator.start();
</code></pre><p>当然我们可以根据需要使用OfInt（）、ofFloat()、ofArgb（）、ofObject()完成不同的效果，当然里面可以传递多个参数值，这些值会在次序执行。</p>
<p>如上所示简单的几行语句就可以实现一个值动画，就是将值在3秒钟从0过渡到500，但是如何使用这个动画呢？<br><br>从上面的图中我们可以可到ValueAnimator 中的UpdateListener，我们可以根据这个监听回调获得我我们想要的值，如何做呢?</p>
<p><img src="http://ww1.sinaimg.cn/large/0060lm7Tgy1fd75jxkyy9j308c08cweh.jpg" alt=""></p>
<p>布局文件很简单，一个textView显示坐标，一个图片用来作用动画，还有一个按钮，不再贴出<br></p>
<pre><code>ValueAnimator valueAnimator = new ValueAnimator().ofFloat(0, 500);
   valueAnimator.setDuration(3000);
   valueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
       @Override
       public void onAnimationUpdate(ValueAnimator valueAnimator) {
           float animatedValue = (float) valueAnimator.getAnimatedValue();
           imageView.setTranslationY(animatedValue);
           text.setText(&quot;imageView X:&quot; + imageView.getY());
       }
   });
   valueAnimator.start();
</code></pre><p>上面的代码很简单，给刚才的动画设置了一个监听，当动画值发生改变时设置给ImageView。<br><img src="http://ww3.sinaimg.cn/large/0060lm7Tgy1fd760tzsrcg30go0engxj.gif" alt=""></p>
<p>可以看到小炸弹的默认Y坐标是217，在经过3秒后他的坐标增加到了717.</p>
<h2 id="ObjectAnimator"><a href="#ObjectAnimator" class="headerlink" title="ObjectAnimator"></a>ObjectAnimator</h2><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>ObjectAnimator是ValueAnimator的子类，ObjectAnimato可以对任意对象进行操作，使用ObjectAnimato可以帮助我们很轻易的完成对任意对象的动画操作，比如View的alpha、scaleX、scaleY、rotationX、rotationY、translationX、translationY、X、Y等。<br><br>为什么我们可以使用View的这些属性呢？因为它在View重定义的有，如下部分：<br><img src="http://ww3.sinaimg.cn/large/0060lm7Tgy1fd7gdhznkoj30ge0dogmm.jpg" alt=""></p>
<p>例如    ：<br></p>
<ul>
<li><p>实现对View的缩放操作。</p>
<pre><code>objectAnimator = new ObjectAnimator()
        .ofFloat(image, &quot;scaleX&quot;, 1f, 0f, 1f);
        objectAnimator.setDuration(2000);
        objectAnimator.start();
</code></pre></li>
</ul>
<ul>
<li>实现对View的旋转操作。</li>
</ul>
<pre><code>objectAnimator = new ObjectAnimator()
        .ofFloat(image, &quot;rotationX&quot;, 0, 360);
        objectAnimator.setDuration(2000);
        objectAnimator.start();
</code></pre><ul>
<li>实现对View的透明度操作</li>
</ul>
<pre><code>objectAnimator = new ObjectAnimator()
      .ofFloat(image, &quot;alpha&quot;, 1f, 0f, 1f);
      objectAnimator.setDuration(2000);
      objectAnimator.start();
</code></pre><ul>
<li><p>实现对View的位移操作</p>
<pre><code>objectAnimator = new ObjectAnimator()
        .ofFloat(image, &quot;translationX&quot;, 0, 300, 0);
        objectAnimator.setDuration(2000);
        objectAnimator.start();
</code></pre></li>
</ul>
<p><strong>当然，我们还可以借助于animatorSet完成组合动画的操作，并控制动画播放的顺序</strong></p>
<ul>
<li><p>实现组合动画</p>
<pre><code>ObjectAnimator alpha = new ObjectAnimator()
        .ofFloat(image, &quot;alpha&quot;, 1f, 0, 1);
        ObjectAnimator translationX = new ObjectAnimator()
        .ofFloat(image, &quot;translationX&quot;, 0, 300, 0);
        ObjectAnimator rotationX = new ObjectAnimator()
        .ofFloat(image, &quot;rotationX&quot;, 0, 360);
        AnimatorSet animatorSet = new AnimatorSet();
        animatorSet.setDuration(3000);
        animatorSet.playTogether(alpha, translationX, rotationX);
        animatorSet.start();
</code></pre></li>
</ul>
<p>透明度变化动画：从完全不透明到透明再到完全不透明<br><br>平移动画：将坐标从现在位置向X正方向偏移300然后再变到0<br><br>旋转动画：将View旋转360°<br><br>然后设置三个动画一起播放</p>
<ul>
<li><p>实现次序播放控制</p>
<pre><code>ObjectAnimator alpha1 = new ObjectAnimator()
        .ofFloat(image, &quot;alpha&quot;, 1f, 0.2f);
        ObjectAnimator alpha2 = new ObjectAnimator()
        .ofFloat(image, &quot;alpha&quot;, 0.2f, 1f);
        ObjectAnimator translationX1 = new ObjectAnimator()
        .ofFloat(image, &quot;translationX&quot;, 0, 300);
        ObjectAnimator translationX2 = new ObjectAnimator()
        .ofFloat(image, &quot;translationX&quot;, 300, 0);
        ObjectAnimator rotationX1 = new ObjectAnimator()
        .ofFloat(image, &quot;rotationX&quot;, 0, 360, 0);
        AnimatorSet animatorSet1 = new AnimatorSet();
        animatorSet1.setDuration(2000);
        animatorSet1.play(alpha1).before(translationX1);
        animatorSet1.play(rotationX1).after(alpha1);
        animatorSet1.play(rotationX1).before(translationX2);
        animatorSet1.play(translationX2).with(alpha2);
        animatorSet1.start();
</code></pre></li>
</ul>
<p>透明度变化动画1：从完全不透明到0.2<br><br>透明度变化动画2：从0.2到透明再到完全不透明<br><br>平移动画1：将坐标从现在位置向X正方向偏移300<br><br>平移动画2：回到原来位置<br><br>旋转动画：将View旋转360°<br></p>
<p>alpha1–&gt;rotationX1、translationX1–&gt;translationX2、alpha2</p>
<p><img src="http://ww1.sinaimg.cn/large/0060lm7Tgy1fd7a4plej1g307i0boaz9.gif" alt=""></p>
<h3 id="使用xml文件创建属性动画"><a href="#使用xml文件创建属性动画" class="headerlink" title="使用xml文件创建属性动画"></a>使用xml文件创建属性动画</h3><pre><code>&lt;animator xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;  
android:valueFrom=&quot;0&quot;  
android:valueTo=&quot;100&quot;  
android:valueType=&quot;intType&quot;/&gt; 
</code></pre><p>或者</p>
<pre><code>&lt;objectAnimator xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;  
android:valueFrom=&quot;1&quot;  
android:valueTo=&quot;0&quot;  
android:valueType=&quot;floatType&quot;  
android:propertyName=&quot;alpha&quot;/&gt; 
</code></pre><p>或者是组合动画： </p>
<pre><code>&lt;set xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;  
android:ordering=&quot;sequentially&quot; &gt;  

&lt;objectAnimator  
    android:duration=&quot;2000&quot;  
    android:propertyName=&quot;translationX&quot;  
    android:valueFrom=&quot;-500&quot;  
    android:valueTo=&quot;0&quot;  
    android:valueType=&quot;floatType&quot; &gt;  
&lt;/objectAnimator&gt;  

&lt;set android:ordering=&quot;together&quot; &gt;  
    &lt;objectAnimator  
        android:duration=&quot;3000&quot;  
        android:propertyName=&quot;rotation&quot;  
        android:valueFrom=&quot;0&quot;  
        android:valueTo=&quot;360&quot;  
        android:valueType=&quot;floatType&quot; &gt;  
    &lt;/objectAnimator&gt;  

    &lt;set android:ordering=&quot;sequentially&quot; &gt;  
        &lt;objectAnimator  
            android:duration=&quot;1500&quot;  
            android:propertyName=&quot;alpha&quot;  
            android:valueFrom=&quot;1&quot;  
            android:valueTo=&quot;0&quot;  
            android:valueType=&quot;floatType&quot; &gt;  
        &lt;/objectAnimator&gt;  
        &lt;objectAnimator  
            android:duration=&quot;1500&quot;  
            android:propertyName=&quot;alpha&quot;  
            android:valueFrom=&quot;0&quot;  
            android:valueTo=&quot;1&quot;  
            android:valueType=&quot;floatType&quot; &gt;  
        &lt;/objectAnimator&gt;  
    &lt;/set&gt;  
&lt;/set&gt;  

&lt;/set&gt;  
</code></pre><p><strong>调用</strong></p>
<pre><code>Animator animator = AnimatorInflater.loadAnimator(context, R.animator.anim_file);  
animator.setTarget(view);  
animator.start();  
</code></pre><p>由于比较简单，就不再具体说明与演示，具体大家可以自己试下</p>
<h3 id="自定义属性"><a href="#自定义属性" class="headerlink" title="自定义属性"></a>自定义属性</h3><p>前面就已经说过，属相动画可以作用任何对象，当然你也可以定义自己的属性，只要对象属性具有set和get方法。</p>
<p>接下来我们以改变Button的宽度。<br><br>首先我们知道，Button 是有setWidth（）和getWidth（）方法的，但是当我们直接对对它做属性动画时却发现没有什么乱用，到底是为什么呢？<br>通过源码我们可以看到Button继承于TextView，而setWidth是TextView和其子类的专属方法，它的作用不是设置View的宽度，而是设置TextView的最大宽度和最小宽度的，这个和TextView的宽度不是一个东西，具体来说，TextView的宽度对应Xml中的android:layout_width属性，而TextView还有一个属性android:width，这个android:width属性就对应了TextView的setWidth方法。</p>
<p>那么，我们该如何通过属性动画来改变Button的宽度呢？</p>
<p>其实很简单只需要在Button外面包一层就好了，在外面设置相应的属性来来改变Button属性。</p>
<pre><code> private static class ViewWrapper {
    private View mTarget;

    public ViewWrapper(View target) {
        mTarget = target;
    }

    public int getWidth() {
        return mTarget.getLayoutParams().width;
    }

    public void setWidth(int width) {
        mTarget.getLayoutParams().width = width;
        mTarget.requestLayout();
    }
}
</code></pre><p>调用的地方：</p>
<pre><code>ViewWrapper viewWrapper = new ViewWrapper(button);
   ObjectAnimator objectAnimator = new ObjectAnimator().ofInt(viewWrapper, &quot;width&quot;,buttonWidth,800);
   objectAnimator.setDuration(2000);
   objectAnimator.start();
</code></pre><p><img src="http://ww1.sinaimg.cn/large/0060lm7Tgy1fd7k2oy9nug30co02s3zg.gif" alt=""></p>
<p>当然，使用<strong>ValueAnimator</strong>同样可以实现上面的效果</p>
<pre><code>  @Override  
    public void onAnimationUpdate(ValueAnimator animator) {  

        int currentValue = (Integer)animator.getAnimatedValue();  

        button.getLayoutParams().width = buttonWidth+currentValue； 
        button.requestLayout();  
    }  
});  
</code></pre><h2 id="Interpolator"><a href="#Interpolator" class="headerlink" title="Interpolator"></a>Interpolator</h2><p>Interpolator用于动画中的时间插值，其作用就是把0到1的浮点值变化映射到另一个浮点值变化</p>
<p>在属性动画中一共有10中插值器</p>
<p><img src="http://ww1.sinaimg.cn/large/0060lm7Tgy1fd7kovzxzjj30nx06gmyb.jpg" alt=""><br>当然，support包中许多不同场景的插值器，这里我们不在做具体的介绍。</p>
<ul>
<li><p>匀速线性<br>LinearInterpolator:</p>
</li>
<li><p>先加速后减速<br>AccelerateDecelerateInterpolator:</p>
</li>
<li><p>一直加速<br>AccelerateInterpolator:</p>
</li>
<li><p>反向移动然后正向加速<br>AnticipateInterpolator:</p>
</li>
<li><p>加速下落回弹<br>BounceInterpolator:</p>
</li>
<li><p>循环播放 参数指定循环次数<br>CycleInterpolator:</p>
</li>
<li><p>减速效果<br>DecelerateInterpolator:</p>
</li>
<li><p>反向超过原来位置 然后正向加速超过规定位置 返回<br>AnticipateOvershootInterpolator:</p>
</li>
<li><p>向前甩一定值后再回到原来位置  可以传值指定加速度值<br>OvershootInterpolator:</p>
</li>
<li><p>按照一定路径完成相应运动的速度<br>PathInterpolator</p>
</li>
</ul>
<p>具体实现如下：<br>初始化动画：</p>
<pre><code>  private void initView() {
    objectAnimator = new ObjectAnimator().ofFloat(image, &quot;translationY&quot;, 0, 1200);
    objectAnimator.setDuration(3000);
}
</code></pre><p>设置插值器并运行动画：</p>
<pre><code> public void onClick(View view) {
switch (view.getId()) {
    //匀速线性
    case R.id.LinearInterpolator:
        objectAnimator.setInterpolator(new LinearInterpolator());
        break;
    //先加速后减速
    case R.id.AccelerateDecelerateInterpolator:
        objectAnimator.setInterpolator(new AccelerateDecelerateInterpolator());
        break;
    //一直加速
    case R.id.AccelerateInterpolator:
        objectAnimator.setInterpolator(new AccelerateInterpolator());
        break;
    //反向移动然后正向加速
    case R.id.AnticipateInterpolator:
        objectAnimator.setInterpolator(new AnticipateInterpolator());
        break;
    //加速下落回弹
    case R.id.BounceInterpolator:
        objectAnimator.setInterpolator(new BounceInterpolator());
        break;
    //循环播放 参数指定循环次数
    case R.id.CycleInterpolator:
        objectAnimator.setInterpolator(new CycleInterpolator(2f));
        break;
    //减速效果
    case R.id.DecelerateInterpolator:
        objectAnimator.setInterpolator(new DecelerateInterpolator());
        break;
    //反向超过原来位置 然后正向加速超过规定位置 返回
    case R.id.AnticipateOvershootInterpolator:
        objectAnimator.setInterpolator(new AnticipateOvershootInterpolator());
        break;
    //向前甩一定值后再回到原来位置  可以传值指定加速度值
    case R.id.OvershootInterpolator:
        objectAnimator.setInterpolator(new OvershootInterpolator());
        break;
    case R.id.PathInterpolator:
        Intent intent=new Intent(InterpolatorActivity.this,InterpolatorPathActivity.class);
        startActivity(intent);
        break;

}
objectAnimator.start();
    }
</code></pre><p><img src="http://ww2.sinaimg.cn/large/0060lm7Tgy1fd7lchfqlfg30dc0kub29.gif" alt=""></p>
<h3 id="PathInterpolator"><a href="#PathInterpolator" class="headerlink" title="PathInterpolator"></a>PathInterpolator</h3><blockquote>
<p>至于<strong>PathInterpolator</strong>这里需要特别做下说明（其他上面的差值器和这个类似，简单的多…），因为它真的很强大，可以实现很多漂亮的效果。</p>
</blockquote>
<p>首先看PathInterpolator 的构造参数里面，可以传入一个path对象、一个控制点或者两个控制点。<br><img src="http://ww2.sinaimg.cn/large/0060lm7Tgy1fd7oahph7kj30cj040mx4.jpg" alt=""></p>
<p>打开<strong>PathInterpolator的源码</strong>我们可以看到</p>
<pre><code>    //构造函数1
 public PathInterpolator(Path path) {
    initPath(path);
}

       //构造函数2
public PathInterpolator(float controlX, float controlY) {
    initQuad(controlX, controlY);
}

       //构造函数3
public PathInterpolator(float controlX1, float controlY1, float controlX2, float controlY2) {
    initCubic(controlX1, controlY1, controlX2, controlY2);
}
    //这个方法里面的东西是不是很熟悉，没错他就是二阶贝塞尔曲线
 private void initQuad(float controlX, float controlY) {
    Path path = new Path();
    path.moveTo(0, 0);
    path.quadTo(controlX, controlY, 1f, 1f);
    initPath(path);
}
    //当然他就是三阶贝塞尔曲线咯
private void initCubic(float x1, float y1, float x2, float y2) {
    Path path = new Path();
    path.moveTo(0, 0);
    path.cubicTo(x1, y1, x2, y2, 1f, 1f);
    initPath(path);
}
</code></pre><p>可以看待三个构造函数归根结底都是构建了一个Path对象，然后对path进行操作<br><br><strong>initPath()</strong></p>
<pre><code> private void initPath(Path path) {
    float[] pointComponents = path.approximate(PRECISION);

    int numPoints = pointComponents.length / 3;
    if (pointComponents[1] != 0 || pointComponents[2] != 0
            || pointComponents[pointComponents.length - 2] != 1
            || pointComponents[pointComponents.length - 1] != 1) {
        throw new IllegalArgumentException(&quot;The Path must start at (0,0) and end at (1,1)&quot;);
    }

    mX = new float[numPoints];
    mY = new float[numPoints];
    float prevX = 0;
    float prevFraction = 0;
    int componentIndex = 0;
    for (int i = 0; i &lt; numPoints; i++) {
        float fraction = pointComponents[componentIndex++];
        float x = pointComponents[componentIndex++];
        float y = pointComponents[componentIndex++];
        if (fraction == prevFraction &amp;&amp; x != prevX) {
            throw new IllegalArgumentException(
                    &quot;The Path cannot have discontinuity in the X axis.&quot;);
        }
        if (x &lt; prevX) {
            throw new IllegalArgumentException(&quot;The Path cannot loop back on itself.&quot;);
        }
        mX[i] = x;
        mY[i] = y;
        prevX = x;
        prevFraction = fraction;
    }
}
</code></pre><p>path.approximat()方法实际就是调用了Native层的方法，返回了一系列值。包括fraction、X、Y等<br><br>通过这个方法我们就得到了我们想要的fraction，这个fraction是实时变化的。我们可以在addUpdateListener的回调中获取：</p>
<pre><code>valueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
       @Override
       public void onAnimationUpdate(ValueAnimator valueAnimator) {

          float animatedFraction = valueAnimator.getAnimatedFraction();

       }
   });
</code></pre><p>animatedFraction这个值是0-1.0f的一个值，描述的是当前动画播放比例，我们回在下面具体介绍。</p>
<pre><code>objectAnimator.setInterpolator(new PathInterpolator(0.8f,0.1f));
</code></pre><p>:</p>
<pre><code>objectAnimator.setInterpolator(new PathInterpolator(0.1f,0.8f));
</code></pre><p><img src="http://ww4.sinaimg.cn/large/0060lm7Tgy1fd7q8djrt6g307j0m8woc.gif" alt="">  <img src="http://ww3.sinaimg.cn/large/0060lm7Tgy1fd7qd234tdg30800m8dpc.gif" alt=""></p>
<p>这样大概看不出什么效果，还是结合Path动画来看下吧 。</p>
<p><strong>首先创建Path动画</strong></p>
<pre><code>Path path = new Path();
path.moveTo(X,Y);
path.quadTo(800, Y, 800, 800);
ObjectAnimator objectAnimator1 = new ObjectAnimator().ofFloat(image, &quot;x&quot;, &quot;y&quot;, path);
objectAnimator1.setDuration(3000);
objectAnimator1.start();
</code></pre><p>上面看到创建的path 将起点定在view的初始位置（X,Y），控制点为(800,Y),结束点为（800,800）<br><br>假设x=y=100</p>
<pre><code>Path path = new Path();
path.moveTo(100,100);
path.quadTo(800, 100, 800, 800);
</code></pre><p><img src="http://ww3.sinaimg.cn/large/0060lm7Tgy1fd8e61n6dcj30c80c8aa3.jpg" alt=""></p>
<p>更好的演示贝塞尔曲线可以看下面的动画，图示的坐标点为控制点（好像有点偏题了了….，这个自定义的View见文底Demo）<br><br>当然如果想进一步学习和了解贝塞尔曲线的可自行google，附上常用贝塞尔曲线<a href="http://cubic-bezier.com" target="_blank" rel="external">在线演示地址</a></p>
<p><img src="http://ww4.sinaimg.cn/large/0060lm7Tgy1fd8e4jjrb0g30c90c8e0k.gif" alt=""></p>
<p>中间的曲线可以随着参数的改变来改变，那么到底是不是这个样子呢？</p>
<p><img src="http://ww3.sinaimg.cn/large/0060lm7Tgy1fd7rapyd3gg30dw0cowid.gif" alt=""></p>
<p>好吧，我们回到动画上，接下来我们给他加上PathInterpolator 制定了连个控制点</p>
<p>objectAnimator1.setInterpolator(new PathInterpolator(0.9f,0.1f,0.5f,0.9f));</p>
<p><img src="http://ww2.sinaimg.cn/large/0060lm7Tgy1fd7reu5itgg30dw0cygpl.gif" alt=""></p>
<p>当然你也可以使用连个控制点来完成不同的加速度效果，其实上面路径的曲线效果就类似与动画的加速度效果。</p>
<p>PathInterpolator就先介绍到这里，接下来看下Evaluator</p>
<h2 id="Evaluator"><a href="#Evaluator" class="headerlink" title="Evaluator"></a>Evaluator</h2><p>Evaluator是值评估器的意思，帮助你很好的完成属性值的计算工作，当然你可以自定义自己的值评估器来完成自己的需要<br>下面是IntEvaluator的源码，可以看到这里有个亿参数叫做fraction，fraction就是上面我们提到的进度比例。</p>
<pre><code>public class IntEvaluator implements TypeEvaluator&lt;Integer&gt; {
  @Override
public Integer evaluate(float fraction, Integer startValue, Integer endValue) {
    int startInt = startValue;
    return (int)(startInt + fraction * (endValue - startInt));
}
</code></pre><p>这里首选获取开始的值，然后加上结束减去中间再乘以进度比例就获得了现在的值。如果起始值为0，那么上面的公式就变成了：</p>
<pre><code> public Integer evaluate(float fraction, Integer startValue, Integer endValue) {

    return (int)（fraction * endValue）;
}
</code></pre><p>那么如果我想让接受方的值扩大5倍怎么办？</p>
<p>当然是直接在这里乘以5就行了，这样外面接受属性值得地方，接收的值就扩大了5倍</p>
<pre><code>@Override
    public Integer evaluate(float fraction, Integer startValue, Integer endValue) {
    int startInt = startValue;
    return (int)(startInt + fraction * (endValue - startInt))*5;
}
</code></pre><h3 id="如何自定义Evaluator"><a href="#如何自定义Evaluator" class="headerlink" title="如何自定义Evaluator"></a>如何自定义Evaluator</h3><p>由IntEvaluator的源码我们可以看到其实现了TypeEvaluator<t>接口，并复写了evaluate函数。</t></p>
<p>那么我们也可以根据这个来自定义自己的估值器。</p>
<p>首先，我们有这样一个场景，学生的年龄年龄从出生到22岁每年增长一岁，学生的体重从出生时的40cm到22岁188cm。<br>Stduent：</p>
<pre><code>public class Student {
       private int age;
       private int height;

public Student(int age, int height) {
    this.age = age;
    this.height = height;
}

public int getAge() {
    return age;
}

public void setAge(int age) {
    this.age = age;
}

public int getHeight() {
    return height;
}

public void setHeight(int height) {
    this.height = height;
}
}
</code></pre><p>StudentEvaluator：自定义估值器，获取对象并作用后返回。</p>
<pre><code>public class StudentEvaluator implements TypeEvaluator&lt;Student&gt; {

@Override
public Student evaluate(float fraction, Student startValue, Student endValue) {
    int startAge = startValue.getAge();
    int startHeight = startValue.getHeight();
    int endAge = endValue.getAge();
    int endHeight = endValue.getHeight();

    int currentAge = (int) (startAge + fraction * (endAge - startAge));

    int currentHeight = (int) (startHeight + fraction * (endHeight - startHeight));

    return new Student(currentAge, currentHeight);
}
}
</code></pre><p>使用估值器：</p>
<pre><code>  ValueAnimator valueAnimator=new ValueAnimator().ofObject(new StudentEvaluator(),
    new Student(0,40),new Student(22,188));
    valueAnimator.setDuration(5000);
    valueAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
        @Override
        public void onAnimationUpdate(ValueAnimator animation) {
            Student student = (Student) animation.getAnimatedValue();
            info.setText(&quot;age:&quot;+student.getAge()+&quot;,height:&quot;+student.getHeight());
        }
    });
valueAnimator.start();
</code></pre><p><img src="http://ww4.sinaimg.cn/large/0060lm7Tgy1fd7t3rupptg30go04z430.gif" alt=""></p>
<p>但是，这样是有前提的啊，前提是学生只能活到22岁，该学生好可悲啊，那么好把，让你活久一点。</p>
<pre><code>ValueAnimator valueAnimator=new ValueAnimator().ofObject(new StudentEvaluator(),
    new Student(0,40),new Student(100,188));
</code></pre><p><img src="http://ww1.sinaimg.cn/large/0060lm7Tgy1fd8a03vkx6g30go04djw8.gif" alt=""></p>
<p>他妈的，这孩子想干啥，虽然长得慢但是也不能一直长啊，纳尼。<br><br>可以发现，无论我们在外面怎么更改，也不能达到我们想要的效果，所以我们只能从StudentEvaluator出发、</p>
<pre><code>  @Override
public Student evaluate(float fraction, Student startValue, Student endValue) {
    int startAge = startValue.getAge();
    int startHeight = startValue.getHeight();
    int endAge = endValue.getAge();
    int endHeight = endValue.getHeight();

    int currentAge = (int) (startAge + fraction * (endAge - startAge));

    int currentHeight = (int) (startHeight + fraction * (endHeight - startHeight));
    if (currentAge&gt;=22){
      currentHeight=188;
    }

    return new Student(currentAge, currentHeight);
}
</code></pre><p>我们可以让使用该估值器的地方随便填写，当然年龄我们就不做限制了，我们这里仅对身高做限制，一般来说年龄到达22就不让他增长了，身高我们暂且都给一个188吧，哈哈。<br>当然，这个估值器里面还存在很多的问题，比如我要是年龄到22了身高没到188怎么办？身高和年龄的成长速度关系等……</p>
<p>估值器先介绍到这里，当然你可以根据自己的业务逻辑完成自己的估值器。</p>
<h2 id="ViewPropertyAnimator"><a href="#ViewPropertyAnimator" class="headerlink" title="ViewPropertyAnimator"></a>ViewPropertyAnimator</h2><p>在3.0以后同样增加的就是ViewPropertyAnimator，总的来说应该也属于属性动画的范畴吧，它的用法比ObjectAnimator更加方便（但是我还是比较上面的方式）</p>
<p>下面是ViewPropertyAnimator的一些特点（<a href="http://blog.csdn.net/guolin_blog/article/details/44171115" title="引用" target="_blank" rel="external">引用</a>）。</p>
<blockquote>
<ul>
<li>整个ViewPropertyAnimator的功能都是建立在View类新增的animate()方法之上的，这个方法会创建并返回一个ViewPropertyAnimator的实例，之后的调用的所有方法，设置的所有属性都是通过这个实例完成的。</li>
</ul>
<ul>
<li>在使用ViewPropertyAnimator时，我们无需调用start()方法，因为新的接口中使用了隐式启动动画的功能，只要我们将动画定义完成之后，动画就会自动启动。并且这个机制对于组合动画也同样有效，只要我们不断地连缀新的方法，那么动画就不会立刻执行，等到所有在ViewPropertyAnimator上设置的方法都执行完毕后，动画就会自动启动。当然如果不想使用这一默认机制的话，我们也可以显式地调用start()方法来启动动画。</li>
</ul>
<ul>
<li>ViewPropertyAnimator的所有接口都是使用连缀的语法来设计的，每个方法的返回值都是它自身的实例，因此调用完一个方法之后可以直接连缀调用它的另一个方法，这样把所有的功能都串接起来，我们甚至可以仅通过一行代码就完成任意复杂度的动画功能。</li>
</ul>
</blockquote>
<p>事例：</p>
<pre><code>imageview.animate().x(500).y(500).alpha(0.8f)setDuration(5000); 

imageview.animate().x(500).y(500).alpha(0.8f)setDuration(5000); 

    go.animate().setInterpolator(new LinearInterpolator()).rotationBy(360).scaleXBy(0.1f).translationZ(30).setDuration(3000)
</code></pre><p>但是，里面新增了相应的以By的结尾的方法，当然就是从现在状态执行相应值，translationZ（）指的是Z轴方向的偏移两<br>是在API21才加入的方法</p>
<p>举个栗子：</p>
<p>点击按钮时让image的Y坐标向下移动300像素，让image旋转720度：</p>
<pre><code>public void onClick() {
    image.animate().translationY(300).rotation(720).setDuration(3000);
}
</code></pre><p><img src="http://ww4.sinaimg.cn/large/0060lm7Tgy1fd88o5wedcg30cs0b9jxi.gif" alt=""></p>
<p>可以看到第一次点击，iamge向下面移动了300像素并伴随着720°的旋转，可以当后面再点击时，发现image并没有任何变化。</p>
<p>那么，现在我们就需要考虑下以By结尾的方法了。</p>
<pre><code> public void onClick() {
    image.animate().translationYBy(300).rotationBy(720).setDuration(3000);
}
</code></pre><p><img src="http://ww2.sinaimg.cn/large/0060lm7Tgy1fd88wfz0jcg30ci0iftm9.gif" alt=""></p>
<p>那么，再来看下Z和translationZBy（），下面就用translationZBy（）来作说明。</p>
<pre><code>  public void onClick() {
    go.animate().translationZBy(30f);
}
</code></pre><p>每次点击，我们让按钮在Z轴的偏移量增加30,效果如下<br><img src="http://ww4.sinaimg.cn/large/0060lm7Tgy1fd892e9i3fg30ex04bgu0.gif" alt=""></p>
<p>当然，我们依然可以给动画设置Listener、UpdateListener、和插值器Interpolator，这些做法和上面讲到的用法一样，就不再具体说明，有兴趣的童鞋可以自己去尝试。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>怎么样，学完属性动画是不是已经爱上它了？没有也没关系，先用起来吧，相信你试过以后一定会爱上我，不，是它，是它！。<br><br>赶脚还有很多东西没写，但是这篇文章真的写了好久了，先这样吧，以后会分析一些真正关于属性动画相关实践的东西。</p>
<p>最后照例：<a href="https://github.com/flyou/PropertyAnimatorDemo" target="_blank" rel="external">Demo地址</a></p>

            </div>
        </div>
    </div>
</article>




    <section id="comment">
        <div class="card">
            <div class="card-content">
                <!-- Duoshuo Comment BEGIN -->
                <div class="ds-thread" data-thread-key="2017/03/02/属性动画入门实践/" data-title="属性动画入门实践" data-url="http://flyou.ren/2017/03/02/属性动画入门实践/"></div>

                <script type="text/javascript">
                    console.log(document.querySelector('.ds-thread'));
                    var duoshuoQuery = {
                        short_name: 'flyou'
                    };
                    (function() {
                        var ds = document.createElement('script');
                        ds.type = 'text/javascript';
                        ds.async = true;
                        ds.src = (document.location.protocol == 'https:'
                            ? 'https:'
                            : 'http:') + '//static.duoshuo.com/embed.js';
                        ds.charset = 'UTF-8';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
                    })();
                </script>
                <!-- Duoshuo Comment END -->
            </div>
        </div>
    </section>



</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large light-green">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect pink" title="回到顶部"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse yellow darken-1"  data-activates="main-menu" title="menu"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer indigo darken-1">
    
    <div class="container">
        <div class="row">
            
            <div class="social-group col m3 s12">
                <h5 class="white-text">社交</h5>
                
                    <a class="social-link" href="http://weibo.com/fangjaylong" target="_blank">
                        <i class="fa fa-2x fa-weibo"></i>
                    </a>
                
                    <a class="social-link" href="https://github.com/flyou" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
            </div>
            

            
            <div class="col m9 s12">
                <h5 class="white-text">友情链接</h5>
                
                    <a class="social-link" href="http://gank.io/" target="_blank">干货集中营</a>
                
                    <a class="social-link" href="http://www.androiddevtools.cn/" target="_blank">AndroidDevTools</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright light-green-link-context">
        <div class="container">
            © 2016 flyou.ren, All rights reserved.
            <p class="right" style="margin-top: 0;"><a href="http://blog.flyou.ren">返回旧版</a> </p>
			 <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span style="margin-left: 80px;" id="busuanzi_container_site_pv">您是本站第 <span id="busuanzi_value_site_pv"></span> 位访问者</span>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();
            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('light-green lighten-2');

            
            // 添加new标签
            $('.menu-reading, .menu-about').append('<span class="new badge light-green"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "search.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword light-green lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword light-green lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



</body>
</html>
